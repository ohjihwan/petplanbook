<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HM010</title>
	<link rel="stylesheet" href="/assets/css/swiper.css">
	<link rel="stylesheet" href="/assets/css/common-ui.css">
	<link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
	<div class="page">
		<div class="container">
			<header class="header">
				<!-- header.html 로 페이지 통합 관리 -->
			</header>

			<main class="contents">
				<div class="content">
					
					<section class="main-banner">
						<figure class="img-box">
							<img src="/assets/imgs/img/img-HM010-3.jpg" alt="">
						</figure>
						<div class="text-box">
							<h2 class="title">어디로 갈까요?</h2>
							<p class="txt">추천 여행지부터 반려인들의 후기까지 한눈에!</p>
							<div class="guide-arrow" aria-label="하단에 컨텐츠가 있습니다">
								<i></i>
								<i></i>
							</div>
						</div>
					</section>

					<section class="suggestion-place">
						<div class="inner">
							<div class="overflow-area">
								<div class="title-box">
									<h2 class="title">추천 목적지</h2>
									<p class="txt">추천 장소를 안내해드립니다</p>
									<a href="../PL/PL010.html" class="button -primary" title="장소 찾기 페이지로 이동">장소 자세히 검색하기</a>
								</div>
								<div class="place-area swiper-wrapper">
									
								</div>
								<div class="swiper-button-next"></div>
								<div class="swiper-button-prev"></div>
							</div>
						</div>
					</section>

					<section class="community-area">
						<div class="inner">
							<div class="title-box">
								<h2 class="title">추천 루트</h2>
								<p class="txt">반려인들이 자랑하는 루트와 다녀온 후기를 구경하세요</p>
							</div>
							<div class="communitys">
								<div class="unit">
									<a href="../CO/CO030.html">
										<div class="img-box">
											<img src="/assets/imgs/temp/temp-list1.jpg" alt="">
										</div>
										<div class="txt-box">
											<p class="main-txt">여태 가본데 중에 여기 최고인거 같아요</p>
											<p class="sub-txt -ellipsis-2">
												김아무개 Lorem ipsum dolor sit amet consectetur adipisicing elit. Molestiae molestias tenetur sed, quidem perferendis quas ex error? Odit ducimus rem dolor, debitis maiores, porro excepturi, nihil sit nobis reprehenderit voluptate.
											</p>
										</div>
										<span class="name">카리나</span>
									</a>
								</div>
								<div class="unit">
									<a href="../CO/CO030.html">
										<div class="img-box">
											<img src="/assets/imgs/temp/temp-list1.jpg" alt="">
										</div>
										<div class="txt-box">
											<p class="main-txt">여태 가본데 중에 여기 최고인거 같아요</p>
											<p class="sub-txt -ellipsis-2">
												진짜로 친절하시구, 친구랑 같이 가기에도 굿!!
											</p>
										</div>
										<span class="name">카리나</span>
									</a>
								</div>
								<div class="unit">
									<a href="../CO/CO030.html">
										<div class="img-box">
											<img src="/assets/imgs/temp/temp-list1.jpg" alt="">
										</div>
										<div class="txt-box">
											<p class="main-txt">여태 가본데 중에 여기 최고인거 같아요</p>
											<p class="sub-txt -ellipsis-2">
												진짜로 친절하시구, 친구랑 같이 가기에도 굿!!
											</p>
										</div>
										<span class="name">카리나</span>
									</a>
								</div>
								<div class="unit">
									<a href="../CO/CO030.html">
										<div class="img-box">
											<img src="/assets/imgs/temp/temp-list1.jpg" alt="">
										</div>
										<div class="txt-box">
											<p class="main-txt">여태 가본데 중에 여기 최고인거 같아요</p>
											<p class="sub-txt -ellipsis-2">
												진짜로 친절하시구, 친구랑 같이 가기에도 굿!!
											</p>
										</div>
										<span class="name">카리나</span>
									</a>
								</div>
							</div>
						</div>
					</section>

					<section class="celebrity-area">
						<div class="inner">
							<div class="title-box">
								<h2 class="title">커뮤니티 인기 루트</h2>
								<p class="txt">반려인들의 여행 기록을 살펴볼까요?</p>
							</div>
							
							<div class="celebrity-people">
								<ul>
									<li>
										<a href="../CO/CO050.html" class="link">
											<div class="ratings">
												<i class="ico -rating"></i>268
											</div>
											<figure class="img-box">
												<img src="/assets/imgs/temp/temp-People1.jpg" alt="">
											</figure>
											<span class="pet-user">
												<span class="pet">뽀삐</span>의 동반자
												<span class="user">카리나</span>님
											</span>
										</a>
									</li>
									<li>
										<a href="../CO/CO050.html" class="link">
											<div class="ratings">
												<i class="ico -rating"></i>268
											</div>
											<figure class="img-box">
												<img src="/assets/imgs/temp/temp-People2.jpg" alt="">
											</figure>
											<span class="pet-user">
												<span class="pet">나비</span>의 동반자
												<span class="user">박영수</span>님
											</span>
										</a>
									</li>
									<li>
										<a href="../CO/CO050.html" class="link">
											<div class="ratings">
												<i class="ico -rating"></i>268
											</div>
											<figure class="img-box">
												<img src="/assets/imgs/temp/temp-People3.jpg" alt="">
											</figure>
											<span class="pet-user">
												<span class="pet">쪼꼬,크림</span>의 동반자
												<span class="user">태리</span>님
											</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</section>

				</div>
			</main>

			<footer class="footer">
				<!-- footer.html 로 페이지 통합 관리 -->
			</footer>
		</div>
	</div>

	<div id="login-modal" class="modal -login-modal"></div>

    <div id="detail" class="modal">
		<div class="container">
			<header class="header">
				<div class="inner">
				<button type="button" class="close" onclick="modalClose()">
					<span class="hide">닫기</span>
				</button>
				</div>
			</header>

			<main class="contents">
				<div class="content">
				<div class="location-detail">
					<div class="title-box">
					<h2 class="title">장소 자세히</h2>
					<p class="txt">자세히 읽고나서 저장해보세요</p>
					</div>

					<div class="detail-imgs swiper detail-imgs">
					<div class="swiper-wrapper"></div>
					<div class="swiper-button-next"></div>
					<div class="swiper-button-prev"></div>
					</div>

					<dl class="details">
					<dt>상호이름</dt>
					<dd></dd>
					<dt>상세주소</dt>
					<dd></dd>
					<dt>대표번호</dt>
					<dd></dd>
					<dt>카테고리</dt>
					<dd></dd>
					</dl>
				</div>
				</div>
			</main>

			<div class="fixed">
				<div class="buttons">
				<button
					type="button"
					class="button -primary -lg"
					onclick="savePlace()"
				>
					이 장소 저장하기
				</button>
				</div>
			</div>
		</div>
	</div>
	<script src="/assets/libs/jquery/jquery-3.6.0.min.js"></script>
	<script src="/assets/libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="/assets/libs/jquery-ui/jquery.ui.touch-punch.min.js"></script>
	<script src="/assets/libs/swiper/dist/js/swiper.min.js"></script>
	<script src="/assets/js/style.js"></script>
	<script src="/assets/js/dev.js"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			loadRecommendedPlaces();
		});
		
		// ✅ Swiper 인스턴스를 전역 변수로 안전하게 설정
		window.mainSuggestionSwiper = window.mainSuggestionSwiper || null;
		
		// ✅ 메인 페이지 추천 장소 로드 함수
		async function loadRecommendedPlaces() {
			try {
				const apiUrl = "https://apis.data.go.kr/B551011/KorPetTourService/areaBasedList?serviceKey=GTr1cI7Wi0FRbOTFBaUzUCzCDP4OnyyEmHnn11pxCUC5ehG5bQnbyztgeydnOWz1O04tjw1SE5RsX8RNo6XCgQ%3D%3D&numOfRows=50&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json";
				
				const response = await fetch(apiUrl, {
					headers: {
						"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
					}
				});
		
				const data = await response.json();
				let places = data.response.body.items.item;
				console.log("✅ 전체 장소 수:", places.length);
	
				// ✅ 조회수 정렬 (내림차순)
				places.sort((a, b) => (b.readcount || 0) - (a.readcount || 0));
				
				// ✅ 상위 50개 조회수 출력
				console.log("✅ 상위 50개 장소 조회수:");
				places.slice(0, 50).forEach((place, index) => {
					console.log(`${index + 1}. ${place.title} - 조회수: ${place.readcount || 0}`);
				});
	
				// ✅ 50개로 잘라서 사용
				places = places.slice(0, 50);
	
				const placeArea = document.querySelector(".place-area");
				placeArea.innerHTML = ""; // 기존 슬라이드 초기화
	
				// ✅ 카테고리별로 장소 분류
				const categorizedPlaces = {
					"🏨 숙박": [],
					"☕🍴 음식점": [],
					"🎢 놀거리": [],
					"📌 기타": []
				};
		
				for (const place of places) {
					const imageUrl = place.firstimage;
					const type = place.contenttypeid;
					if (!imageUrl) continue;
		
					const image = await checkImageLoad(imageUrl);
					if (!image) continue;
		
					const category = getCategoryByType(type);
					categorizedPlaces[category].push(place);
				}
	
				// ✅ 각 카테고리에서 랜덤하게 최대 2개씩 선택
				Object.keys(categorizedPlaces).forEach(category => {
					const shuffledPlaces = shuffleArray(categorizedPlaces[category]);
					shuffledPlaces.slice(0, 2).forEach(place => {
						const slide = document.createElement("a");
						slide.href = "javascript:void(0)";
						slide.classList.add("place", "swiper-slide");
	
						const categoryClass = getCategoryClassByType(category);
						slide.innerHTML = `
							<div class="img-box">
								<img src="${place.firstimage}" alt="${place.title}">
							</div>
							<div class="place-info">
								<h3 class="main-txt">${place.title}</h3>
								<span class="sub-txt">주소 : ${place.addr1 || '주소 정보 없음'}</span>
							</div>
							<div class="category ${categoryClass}">
								${category}
							</div>
						`;
	
						placeArea.appendChild(slide);
					});
				});
		
				console.log("✅ 로드된 장소 수:", placeArea.children.length);
		
				// ✅ 로드된 슬라이드가 있을 때만 Swiper 초기화
				if (placeArea.children.length > 0) {
					initializeSwiper();
				} else {
					console.warn("⚠️ 추천 장소를 불러올 수 없습니다.");
				}
			} catch (error) {
				console.error("🔥 추천 장소 로드 오류:", error);
			}
		}
		
		// ✅ Swiper 초기화 함수
		function initializeSwiper() {
			if (window.mainSuggestionSwiper) {
				window.mainSuggestionSwiper.destroy(true, true);
				window.mainSuggestionSwiper = null;
			}
		
			window.mainSuggestionSwiper = new Swiper(".suggestion-place .overflow-area", {
				slideClass: "place",
				observer: true,
				observerParents: true,
				loop: true,
				autoplay: {
					delay: 2500,
					disableOnInteraction: false
				},
				loopedSlides: 10,
				speed: 500,
				watchOverflow: true,
				effect: "coverflow",
				grabCursor: true,
				centeredSlides: true,
				slidesPerView: "auto",
				coverflowEffect: {
					rotate: 15,
					stretch: 0,
					depth: 100,
					modifier: 2,
					slideShadows: true,
				},
				navigation: {
					nextEl: ".swiper-button-next",
					prevEl: ".swiper-button-prev",
				},
			});
			
			$(document).on('mouseenter','.suggestion-place .overflow-area', function () {
				mainSuggestionSwiper.autoplay.stop();
			}).on('mouseleave','.suggestion-place .overflow-area', function () {
				mainSuggestionSwiper.autoplay.start();
			});
		}
		
		// ✅ 이미지 로드 확인 함수 (비동기)
		async function checkImageLoad(url) {
			return new Promise((resolve) => {
				const img = new Image();
				img.src = url;
				img.onload = () => resolve(true);
				img.onerror = () => resolve(false);
			});
		}
		
		// ✅ 카테고리 라벨 지정 함수 (contenttypeid 기준)
		function getCategoryByType(type) {
			if (type == 32) return "🏨 숙박";
			if (type == 39) return "☕🍴 음식점";
			if (type == 12 || type == 28) return "🎢 놀거리";
			return "📌 기타";
		}
		
		// ✅ 카테고리 스타일 클래스 지정 함수
		function getCategoryClassByType(category) {
			if (category.includes("숙박")) return "lodging";
			if (category.includes("음식점") || category.includes("카페")) return "cafe";
			if (category.includes("놀거리")) return "activity";
			return "etc";
		}
		
		// ✅ 랜덤 섞기 함수
		function shuffleArray(array) {
			return array.sort(() => Math.random() - 0.5);
		}
	</script>
</body>
</html>