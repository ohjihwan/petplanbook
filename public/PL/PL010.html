<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PL010</title>
	<link rel="stylesheet" href="/assets/css/swiper.css">
	<link rel="stylesheet" href="/assets/css/common-ui.css">
	<link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
	<div class="page">
		<div class="container">
			<header class="header">
				<!-- header.html 로 페이지 통합 관리 -->
			</header>

			<main class="contents">
				<div class="content">

					<section class="main-banner">
						<figure class="img-box">
							<img src="/assets/imgs/img/img-PL010-1.jpg" alt="">
						</figure>
						<div class="text-box">
							<h2 class="title">장소찾기</h2>
							<p class="txt">반려동물과 함께 여행할 장소를 찾아보세요</p>
							<div class="guide-arrow" aria-label="하단에 컨텐츠가 있습니다">
								<i></i>
								<i></i>
							</div>
						</div>
					</section>
					
					<section class="map-content-area">
						<div class="inner">
							<div class="function-box">
								<!-- API 기능 -->
								<div id="map" class="map-box"></div>
								<!-- // -->
								<div class="field-area">
									<div class="field">
										<label for="region" class="label">지역</label>
										<div class="select">
										<select name="region" id="region" onchange="toggleSelect()">
											<option value="">지역 선택</option>
											<option value="강원특별자치도">강원특별자치도</option>
											<option value="경기도">경기도</option>
											<option value="경상남도">경상남도</option>
											<option value="경상북도">경상북도</option>
											<option value="광주광역시">광주광역시</option>
											<option value="대구광역시">대구광역시</option>
											<option value="대전광역시">대전광역시</option>
											<option value="부산광역시">부산광역시</option>
											<option value="서울특별시">서울특별시</option>
											<option value="세종특별자치시">세종특별자치시</option>
											<option value="울산광역시">울산광역시</option>
											<option value="인천광역시">인천광역시</option>
											<option value="전라남도">전라남도</option>
											<option value="전라북도">전라북도</option>
											<option value="제주특별자치도">제주특별자치도</option>
											<option value="충청남도">충청남도</option>
											<option value="충청북도">충청북도</option>
										</select>
										</div>
									</div>
									
									<div class="field">
										<label for="text1" class="label">장소 검색</label>
										<div class="text">
										<input type="text" id="text1" required placeholder="(예시:애견유치원)">
										</div>
									</div>
									
									<div class="checkboxs">
										<div class="checkbox">
											<input type="checkbox" id="lodgment" name="check" class="checked" value="숙박">
											<label for="lodgment">숙박</label>
										</div>
										<div class="checkbox">
											<input type="checkbox" id="eating" name="check" class="checked" value="음식점">
											<label for="eating">음식점</label>
										</div>
										<div class="checkbox">
											<input type="checkbox" id="place" name="check" class="checked" value="놀거리">
											<label for="place">놀거리</label>
										</div>
										<div class="checkbox">
											<input type="checkbox" id="etc" name="check" class="checked" value="기타">
											<label for="etc">기타</label>
										</div>
									</div>
									
									<div class="field">
										<label for="text3" class="label">날짜 선택</label>
										<div class="text">
											<input type="date" id="text3" required placeholder="날짜를 선택해주세요">
										</div>
									</div>
									
									<div class="comp-buttons">
										<button type="button" id="compButtons" class="button -primary -lg w-full" onclick="searchTravelList()" disabled>탐색하기</button>
									</div>
								</div>
							</div>

							<div id="travel-list" class="search-result-box">
								<ul></ul>
								<div class="buttons -center">
									<button id="load-more" style="display:none;" class="button -secondary -md travel-list-more" onclick="loadMore()">더보기</button>
								</div>
							</div>
						</div>
					</section>

				</div>
			</main>

			<footer class="footer">
				<!-- footer.html 로 페이지 통합 관리 -->
			</footer>
		</div>
	</div>

	<div id="login-modal" class="modal -login-modal"></div>
	
	<div id="detail" class="modal">
		<div class="container">
			<header class="header">
				<div class="inner">
					<button type="button" class="close" onclick="modalClose()"><span class="hide">닫기</span></button>
				</div>
			</header>

			<main class="contents">
				<div class="content">
					
					<div class="location-detail">
						<div class="title-box">
							<h2 class="title">장소 자세히</h2>
							<p class="txt">자세히 읽고나서 저장해보세요</p>
						</div>

						<div class="detail-imgs swiper detail-imgs">
							<div class="swiper-wrapper"></div>
							<div class="swiper-button-next"></div>
							<div class="swiper-button-prev"></div>
						</div>
						
						<dl class="details">
							<dt>상호이름</dt>
							<dd></dd>
							<dt>상세주소</dt>
							<dd></dd>
							<dt>대표번호</dt>
							<dd></dd>
							<dt>카테고리</dt>
							<dd></dd>
						</dl>
					</div>

				</div>
			</main>

			<div class="fixed">
				<div class="buttons">
					<button type="button" class="button -primary -lg" onclick="savePlace()">이 장소 저장하기</button>
				</div>
			</div>
		</div>
	</div>

	<script src="/assets/libs/jquery/jquery-3.6.0.min.js"></script>
	<script src="/assets/libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="/assets/libs/jquery-ui/jquery.ui.touch-punch.min.js"></script>
	<script src="/assets/libs/swiper/dist/js/swiper.min.js"></script>
	<script src="/assets/js/style.js"></script>
	<script src="/assets/js/dev.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=706f2ef595d7fa1279baace1d65f8f18&libraries=services"></script>
	<script src="/assets/js/map.js"></script>
	<!-- <script src="/assets/js/API.js"></script> -->
	<script>
		async function savePlace() {
			const details = document.querySelectorAll("#detail .details dd");
			const title = details[0].textContent;
			const addr1 = details[1].textContent;
			const tel = details[2].textContent;
			const category = details[3].textContent;

			try {
				const response = await fetch(`http://localhost:8081/api/save-place`, {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ title, addr1, tel, category }),
				});

				if (!response.ok) {
					throw new Error(`서버 응답 실패: ${response.status}`);
				}

				const result = await response.json();

				if (result.success) {
					const confirmed = confirm("✅ 장소가 저장되었습니다! MY장소로 이동하시겠습니까?");
				if (confirmed) {
					console.log("사용자가 [예]를 눌렀습니다.");
					window.location.href = `http://127.0.0.1:8081/public/MY/MY022.html`;
				} else {
					console.log("사용자가 [아니오]를 눌렀습니다.");
				}
				} else {
					alert("⚠️ 저장에 실패했습니다: " + result.message);
				}
			} catch (error) {
				console.error(error);
				alert("❌ 서버 오류 발생: " + error.message);
			}
		}
	</script>
</body>
</html>