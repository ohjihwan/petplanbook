<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PL010</title>
    <link rel="stylesheet" href="/assets/css/swiper.css" />
    <link rel="stylesheet" href="/assets/css/common-ui.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
  </head>
  <body>
    <div class="page">
      <div class="container">
        <header class="header">
          <!-- header.html ë¡œ í˜ì´ì§€ í†µí•© ê´€ë¦¬ -->
        </header>

        <main class="contents">
          <div class="content">
            <section class="main-banner">
              <figure class="img-box">
                <img src="/assets/imgs/img/img-PL010-1.jpg" alt="" />
              </figure>
              <div class="text-box">
                <h2 class="title">ì¥ì†Œì°¾ê¸°</h2>
                <p class="txt">ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ ì—¬í–‰í•  ì¥ì†Œë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
                <div class="guide-arrow" aria-label="í•˜ë‹¨ì— ì»¨í…ì¸ ê°€ ìˆìŠµë‹ˆë‹¤">
                  <i></i>
                  <i></i>
                </div>
              </div>
            </section>

            <section class="map-content-area">
              <div class="inner">
                <div class="function-box">
                  <div id="map" class="map-box"></div>
                  <div class="field-area">
                    <div class="field">
                      <label for="region" class="label">ì§€ì—­</label>
                      <div class="select">
                        <select name="region" id="region">
                          <option value="">ì§€ì—­ ì„ íƒ</option>
                          <option value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
                          <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                          <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
                          <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                          <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                          <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                          <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                          <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                          <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                          <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                          <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                          <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                          <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                          <option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
                          <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                          <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                          <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
                        </select>
                      </div>
                    </div>

                    <div class="field">
                      <label for="text1" class="label">ì¥ì†Œ ê²€ìƒ‰</label>
                      <div class="text">
                        <input
                          type="text"
                          id="text1"
                          required
                          placeholder="(ì˜ˆì‹œ:ì• ê²¬ìœ ì¹˜ì›)"
                        />
                      </div>
                    </div>

                    <div class="checkboxs">
                      <div class="checkbox">
                        <input
                          type="checkbox"
                          id="lodgment"
                          name="check"
                          class="checked"
                          value="ìˆ™ë°•"
                        />
                        <label for="lodgment">ìˆ™ë°•</label>
                      </div>
                      <div class="checkbox">
                        <input
                          type="checkbox"
                          id="eating"
                          name="check"
                          class="checked"
                          value="ìŒì‹ì "
                        />
                        <label for="eating">ìŒì‹ì </label>
                      </div>
                      <div class="checkbox">
                        <input
                          type="checkbox"
                          id="place"
                          name="check"
                          class="checked"
                          value="ë†€ê±°ë¦¬"
                        />
                        <label for="place">ë†€ê±°ë¦¬</label>
                      </div>
                      <div class="checkbox">
                        <input
                          type="checkbox"
                          id="etc"
                          name="check"
                          class="checked"
                          value="ê¸°íƒ€"
                        />
                        <label for="etc">ê¸°íƒ€</label>
                      </div>
                    </div>

                    <div class="field">
                      <label for="text3" class="label">ë‚ ì§œ ì„ íƒ</label>
                      <div class="text">
                        <input
                          type="date"
                          id="text3"
                          required
                          placeholder="ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"
                        />
                      </div>
                    </div>

                    <div class="comp-buttons">
                      <button
                        type="button"
                        class="button -primary -lg w-full"
                        onclick="searchTravelList()"
                      >
                        ê²€ìƒ‰í•˜ê¸°
                      </button>
                    </div>
                  </div>
                </div>

                <div id="travel-list" class="search-result-box">
                  <ul></ul>
                  <div class="buttons -center">
                    <button
                      id="load-more"
                      style="display: none"
                      class="button -secondary -md travel-list-more"
                      onclick="loadMore()"
                    >
                      ë”ë³´ê¸°
                    </button>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </main>

        <footer class="footer">
          <!-- footer.html ë¡œ í˜ì´ì§€ í†µí•© ê´€ë¦¬ -->
        </footer>
      </div>
    </div>

    <div id="login-modal" class="modal -login-modal"></div>

    <div id="detail" class="modal" style="display: none">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">ë‹«ê¸°</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="location-detail">
              <div class="title-box">
                <h2 class="title">ì¥ì†Œ ìì„¸íˆ</h2>
                <p class="txt">ìì„¸íˆ ì½ê³ ë‚˜ì„œ ì €ì¥í•´ë³´ì„¸ìš”</p>
              </div>

              <div class="detail-imgs swiper mySwiper">
                <div class="swiper-wrapper">
                  <div class="swiper-slide">
                    <img src="/assets/imgs/temp/temp1.png" alt="" />
                  </div>
                  <div class="swiper-slide">
                    <img src="/assets/imgs/temp/temp2.png" alt="" />
                  </div>
                  <div class="swiper-slide">
                    <img src="/assets/imgs/temp/temp3.png" alt="" />
                  </div>
                  <div class="swiper-slide">
                    <img src="/assets/imgs/temp/temp4.jpg" alt="" />
                  </div>
                  <div class="swiper-slide">
                    <img src="/assets/imgs/temp/temp5.jpg" alt="" />
                  </div>
                  <div class="swiper-slide">
                    <img src="/assets/imgs/temp/temp6.jpg" alt="" />
                  </div>
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
              </div>

              <dl class="details">
                <dt>ìƒí˜¸ì´ë¦„</dt>
                <dd>í¼í”¼ìŠ¤ë“œë¦¼</dd>
                <dt>ìƒì„¸ì£¼ì†Œ</dt>
                <dd>ì„œìš¸ ì„œì´ˆêµ¬ ì„œë˜ë¡œ</dd>
                <dt>ëŒ€í‘œë²ˆí˜¸</dt>
                <dd>02-000-0000</dd>
                <dt>ì¹´í…Œê³ ë¦¬</dt>
                <dd>ìˆ™ë°•</dd>
              </dl>
            </div>
          </div>
        </main>

        <div class="fixed">
          <div class="buttons">
            <button
              type="button"
              class="button -primary -lg"
              onclick="savePlace()"
            >
              ì´ ì¥ì†Œ ì €ì¥í•˜ê¸°
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="/assets/libs/jquery/jquery-3.6.0.min.js"></script>
    <script src="/assets/libs/jquery-ui/jquery-ui.min.js"></script>
    <script src="/assets/libs/jquery-ui/jquery.ui.touch-punch.min.js"></script>
    <script src="/assets/libs/swiper/dist/js/swiper.min.js"></script>
    <script src="/assets/js/style.js"></script>
    <script src="/assets/js/dev.js"></script>
    <script src="/assets/js/map.js"></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=706f2ef595d7fa1279baace1d65f8f18&libraries=services"
    ></script>
    <script>
      let travelData = [];
      let filteredData = [];
      let currentPage = 1;
      const itemsPerPage = 8;

      async function fetchTravelList() {
        const listUrl = `https://apis.data.go.kr/B551011/KorPetTourService/areaBasedList?serviceKey=GTr1cI7Wi0FRbOTFBaUzUCzCDP4OnyyEmHnn11pxCUC5ehG5bQnbyztgeydnOWz1O04tjw1SE5RsX8RNo6XCgQ%3D%3D&numOfRows=1000&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json`;
        console.log("ğŸ“¡ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ API ìš”ì²­:", listUrl);
        const response = await fetch(listUrl);
        const apiData = await response.json();
        travelData = apiData.response?.body?.items?.item || [];
        filterAndDisplayList();
      }

      document.getElementById("text1").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          searchTravelList();
        }
      });

      function searchTravelList() {
        travelData = [];
        filteredData = [];
        currentPage = 1;
        fetchTravelList();
      }

      function filterAndDisplayList() {
        const searchText = document
          .getElementById("text1")
          .value.trim()
          .toLowerCase();
        const region = document.getElementById("region").value;
        const selectedCategories = Array.from(
          document.querySelectorAll(".checkbox input:checked")
        ).map((checkbox) => checkbox.value);

        filteredData = travelData.filter((item) => {
          const matchesText = item.title.toLowerCase().includes(searchText);
          const matchesRegion =
            region === "" || (item.addr1 && item.addr1.includes(region));
          const matchesCategory =
            selectedCategories.length === 0 ||
            selectedCategories.includes(
              getCategory(item).replace(/[^ê°€-í£]/g, "")
            );
          return matchesText && matchesRegion && matchesCategory;
        });

        displayTravelList();
      }

      function displayTravelList() {
        const list = document.getElementById("travel-list");
        const ul = list.querySelector("ul");
        ul.innerHTML = "";

        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const displayItems = filteredData.slice(0, end);

        displayItems.forEach((item) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <a href="javascript:void(0)" role="button">
              <div class="img-box">
                <div class="category ${getCategoryClass(item)}">${getCategory(
            item
          )}</div>
                <img src="${
                  item.firstimage ||
                  "https://dummyimage.com/200x200/cccccc/ffffff&text=No+Image"
                }" alt="${item.title}">
              </div>
              <div class="txts">
                <strong class="main-txt">${item.title}</strong>
                <span class="sub-txt">${item.addr1 || "ì£¼ì†Œ ì •ë³´ ì—†ìŒ"}</span>
              </div>
            </a>
          `;
          li.addEventListener("click", () => openDetailModal(item));
          ul.appendChild(li);
        });

        const loadMoreButton = document.getElementById("load-more");
        if (displayItems.length >= itemsPerPage && end < filteredData.length) {
          loadMoreButton.style.display = "inline-block";
        } else {
          loadMoreButton.style.display = "none";
        }

        console.log(
          `ğŸ“Š ë…¸ì¶œëœ ì•„ì´í…œ ìˆ˜: ${ul.querySelectorAll("li").length} / ${
            filteredData.length
          }`
        );
      }

      function loadMore() {
        currentPage++;
        displayTravelList();
      }

      function getCategoryClass(item) {
        const type = item.contenttypeid;
        if (type === "32") return "lodging";
        if (type === "39") return "cafe";
        if (type === "12" || type === "28") return "activity";
        return "etc";
      }

      function getCategory(item) {
        const type = getCategoryClass(item);
        if (type === "lodging") return "ğŸ¨ ìˆ™ë°•";
        if (type === "cafe") return "â˜•ğŸ´ ìŒì‹ì ";
        if (type === "activity") return "ğŸ¢ ë†€ê±°ë¦¬";
        return "ğŸ“Œ ê¸°íƒ€";
      }

      // âœ… ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ ì¶”ê°€
      function openDetailModal(item) {
        const modal = document.getElementById("detail");
        const swiperWrapper = modal.querySelector(".swiper-wrapper");
        swiperWrapper.innerHTML = `
          <div class="swiper-slide">
            <img src="${
              item.firstimage ||
              "https://dummyimage.com/200x200/cccccc/ffffff&text=No+Image"
            }" alt="${item.title}">
          </div>
        `;
        const details = modal.querySelectorAll(".details dd");
        details[0].textContent = item.title || "-";
        details[1].textContent = item.addr1 || "-";
        details[2].textContent = item.tel || "-";
        details[3].textContent = getCategory(item) || "-";
        modal.style.display = "block";
        new Swiper(".mySwiper", {
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
          },
        });
      }

      // âœ… ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ ì¶”ê°€
      function modalClose() {
        document.getElementById("detail").style.display = "none";
      }

      async function savePlace() {
        const details = document.querySelectorAll("#detail .details dd");
        const title = details[0].textContent;
        const addr1 = details[1].textContent;
        const tel = details[2].textContent;
        const category = details[3].textContent;

        try {
          const response = await fetch("http://localhost:5501/api/save-place", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title, addr1, tel, category }),
          });

          if (!response.ok) {
            throw new Error(`ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨: ${response.status}`);
          }

          const result = await response.json();

          if (result.success) {
            const confirmed = confirm(
              "âœ… ì¥ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! MYì¥ì†Œë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
            );
            if (confirmed) {
              console.log("ì‚¬ìš©ìê°€ [ì˜ˆ]ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.");
              window.location.href =
                "http://127.0.0.1:5501/public/MY/MY022.html"; //ì˜ˆì‹œ public html!!! ë³€ê²½í•´ì¤˜ì•¼í•¨
            } else {
              console.log("ì‚¬ìš©ìê°€ [ì•„ë‹ˆì˜¤]ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.");
            }
          } else {
            alert("âš ï¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + result.message);
          }
        } catch (error) {
          console.error(error);
          alert("âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ: " + error.message);
        }
      }
    </script>
  </body>
</html>
