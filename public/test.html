<!DOCTYPE html>
<html>
<head>
  <title>ë°˜ë ¤ë™ë¬¼ ë™ë°˜ ì—¬í–‰ì§€</title>
  <style>
    .search-container {
      margin-bottom: 20px;
    }
    .category {
      font-size: 14px;
      font-weight: bold;
      padding: 3px 8px;
      border-radius: 5px;
      display: inline-block;
    }
    .category.lodging { background-color: #FFD700; color: #000; }
    .category.cafe { background-color: #FF6347; color: #fff; }
    .category.activity { background-color: #4CAF50; color: #fff; }
    .category.etc { background-color: #777; color: #fff; }
  </style>
</head>
<body>
  <h1>ë°˜ë ¤ë™ë¬¼ ë™ë°˜ ì—¬í–‰ì§€</h1>
  <div class="search-container">
    <input type="text" id="search-input" placeholder="ì—¬í–‰ì§€ ê²€ìƒ‰..." onkeydown="if(event.key === 'Enter') searchTravelList()" />
    <button onclick="searchTravelList()">ê²€ìƒ‰</button>
  </div>

  <div class="filter-container">
    <label><input type="checkbox" class="category-checkbox" value="lodging"> ìˆ™ë°•</label>
    <label><input type="checkbox" class="category-checkbox" value="cafe"> ì¹´í˜/ìŒì‹ì </label>
    <label><input type="checkbox" class="category-checkbox" value="activity"> ë†€ê±°ë¦¬</label>
    <label><input type="checkbox" class="category-checkbox" value="etc"> ê¸°íƒ€</label>


    
  </div>

  <div id="travel-list" style="display:none;">
    <ul>
        
    </ul>
  </div>
  <button id="load-more" style="display:none;" onclick="loadMore()">ë”ë³´ê¸°</button>
  
  <script>
    let travelData = [];
    let filteredData = [];
    let currentPage = 1;
    const itemsPerPage = 8;

    async function fetchTravelList() {
      try {
        const listUrl = `https://apis.data.go.kr/B551011/KorPetTourService/areaBasedList?serviceKey=GTr1cI7Wi0FRbOTFBaUzUCzCDP4OnyyEmHnn11pxCUC5ehG5bQnbyztgeydnOWz1O04tjw1SE5RsX8RNo6XCgQ%3D%3D&numOfRows=1000&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json`;
        
        console.log("ğŸ“¡ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ API ìš”ì²­:", listUrl);

        const apiResponse = await fetch(listUrl);
        const apiData = await apiResponse.json();
        console.log("âœ… API ì‘ë‹µ:", apiData);

        travelData = apiData.response?.body?.items?.item || [];
        filterAndDisplayList();
      } catch (error) {
        console.error("âŒ API ìš”ì²­ ì—ëŸ¬:", error.message);
        document.getElementById("travel-list").style.display = "block";
        document.getElementById("travel-list").innerHTML = "<ul><li>API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</li></ul>";
      }
    }

    // ê²€ìƒ‰ ê¸°ëŠ¥ (ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ)
    function searchTravelList() {
      if (!document.getElementById("search-input").value.trim()) {
        alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      travelData = [];
      filteredData = [];
      currentPage = 1;
      document.getElementById("travel-list").style.display = "none";
      document.getElementById("load-more").style.display = "none";
      fetchTravelList();
    }

    // ê²€ìƒ‰ì–´ì™€ ì¹´í…Œê³ ë¦¬ í•„í„°ë§ (ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ)
    function filterAndDisplayList() {
      const searchText = document.getElementById("search-input").value.trim().toLowerCase();
      const selectedCategories = Array.from(document.querySelectorAll(".category-checkbox:checked"))
        .map(checkbox => checkbox.value);

      filteredData = travelData.filter(item => {
        const matchesText = item.title.toLowerCase().includes(searchText);
        const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(getCategoryType(item));
        return matchesText && matchesCategory;
      });

      sortByTopReadCount();
      displayTravelList();
    }

    // ì¡°íšŒìˆ˜ ë†’ì€ í•­ëª©ì„ ì²« ë²ˆì§¸ë¡œ ë°°ì¹˜ (í•˜ë‚˜ë§Œ)
    function sortByTopReadCount() {
      if (filteredData.length === 0) return;

      const maxReadItem = filteredData.reduce((max, item) => 
        item.readcount > (max.readcount || 0) ? item : max, {});

      if (maxReadItem.readcount > 0) {
        filteredData = filteredData.filter(item => item !== maxReadItem);
        filteredData.unshift(maxReadItem);
      }
    }

    // ì—¬í–‰ì§€ ëª©ë¡ í‘œì‹œ (ìµœëŒ€ 8ê°œì”©)
    function displayTravelList() {
      const list = document.getElementById("travel-list");
      list.innerHTML = "<ul></ul>";
      list.style.display = "block";
      const ul = list.querySelector("ul");

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const displayItems = filteredData.slice(0, end);

      if (displayItems.length > 0) {
        displayItems.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = `
            <a href="javascript:void(0)" role="button" onclick="modalOpenId('detail')">
              <div class="img-box">
                <div class="flags">
                  <div class="category ${getCategoryType(item)}">${getCategory(item)}</div>
                </div>
                <img src="${item.firstimage || 'https://dummyimage.com/200x200/cccccc/ffffff&text=No+Image'}" alt="${item.title}">
              </div>
              <div class="txts">
                <strong class="main-txt">${item.title}</strong>
                <span class="sub-txt">${item.addr1 || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</span>
              </div>
            </a>
          `;
          ul.appendChild(li);
        });

        document.getElementById("load-more").style.display = displayItems.length >= itemsPerPage && end < filteredData.length ? "block" : "none";
      } else {
        ul.innerHTML = "<li>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
        document.getElementById("load-more").style.display = "none";
      }

      // ë…¸ì¶œëœ li ìˆ˜ ì½˜ì†”ì— ì¶œë ¥
      console.log(`ğŸ“Š ë…¸ì¶œëœ ì•„ì´í…œ ìˆ˜: ${ul.querySelectorAll("li").length} / ${filteredData.length}`);
    }

    // ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ
    function loadMore() {
      currentPage++;
      displayTravelList();
    }

    // ì¹´í…Œê³ ë¦¬ êµ¬ë¶„ í•¨ìˆ˜
    function getCategoryType(item) {
      const type = item.contenttypeid;
      if (type === "32") return "lodging";
      if (type === "39") return "cafe";
      if (type === "12" || type === "28") return "activity";
      return "etc";
    }

    function getCategory(item) {
      const type = getCategoryType(item);
      if (type === "lodging") return "ğŸ¨ ìˆ™ë°•";
      if (type === "cafe") return "â˜• ì¹´í˜ / ìŒì‹ì ";
      if (type === "activity") return "ğŸ¢ ë†€ê±°ë¦¬";
      return "ğŸ“Œ ê¸°íƒ€";
    }
</script>

</body>
</html>
