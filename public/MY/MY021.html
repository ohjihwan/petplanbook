<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>CM020</title>
	<link rel="stylesheet" href="/assets/css/swiper.css" />
	<link rel="stylesheet" href="/assets/css/common-ui.css" />
	<link rel="stylesheet" href="/assets/css/style.css" />
</head>
<body>
	<div class="page">
		<div class="container">
			<header class="header">
				<!-- header.html ë¡œ í˜ì´ì§€ í†µí•© ê´€ë¦¬ -->
			</header>

			<main class="contents">
				<div class="content">
					<section class="main-banner">
						<figure class="img-box">
							<img src="/assets/imgs/img/img-CM010-1.jpg" alt="" />
						</figure>
						<div class="text-box">
							<h2 class="title">ì¶”ì²œ ë£¨íŠ¸</h2>
							<p class="txt">
								ë‹¤ë¥¸ ë°˜ë ¤ì¸ë“¤ì´ ë‹¤ë…€ì˜¨ ë£¨íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¼ í•´ë³´ì„¸ìš”!
							</p>
							<div class="guide-arrow" aria-label="í•˜ë‹¨ì— ì»¨í…ì¸ ê°€ ìˆìŠµë‹ˆë‹¤">
								<i></i>
								<i></i>
							</div>
						</div>
					</section>

					<section class="map-content-area">
						<div class="inner">
							<div class="title-box">
								<h2 class="title">ë£¨íŠ¸ê¾¸ë¯¸ê¸°</h2>
								<!--	
								ìˆ˜ì •í•˜ê¸° ê¸°ëŠ¥ ì‹œ
								<h2 class="title">ìˆ˜ì •í•˜ê¸°</h2>
							-->
								<p class="txt">ì¡°ê¸ˆë§Œ ë” ê¾¸ë©°ë³¼ê¹Œìš”?</p>
							</div>

							<div class="function-box -gray-case">
								<div class="following-path">
									<div class="scrolling swiper-wrapper">
										<ul class="swiper-slide">
											<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    const res = await fetch("http://localhost:8081/api/saved-routes"); // â† ê²½ë¡œ ì£¼ì˜
    const result = await res.json();

    if (!result.success) {
      throw new Error("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
    }

    const slideList = document.querySelector(".swiper-slide");
    slideList.innerHTML = ""; // ê¸°ì¡´ ë”ë¯¸ ì œê±°

    result.data.forEach((route) => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${route.title}</strong>
        <dl>
          <dt>ì£¼ì†Œ</dt>
          <dd>${route.addr1}</dd>
          <dt>ì „í™”</dt>
          <dd>${route.tel}</dd>
          <dt>ë¶„ë¥˜</dt>
          <dd>${route.category}</dd>
          <dt>ì´ë¯¸ì§€</dt>
          <dd><img src="${route.firstimage}" alt="${route.title}" width="100" /></dd>
        </dl>
      `;
      slideList.appendChild(li);
    });
  } catch (err) {
    console.error("ğŸš« ì¶”ì²œ ë£¨íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err.message);
  }
});
</script>

										</ul>
									</div>
								</div>
								<!-- API ê¸°ëŠ¥ -->
								<div id="map" class="map-box"></div>
								<!-- // -->
								<form
									id="placeForm"
									enctype="multipart/form-data"
									class="field-area"
								>
									<div class="field">
										<label for="name" class="label">ê¸€ ì œëª©</label>
										<div class="text">
											<input
												type="text"
												id="name"
												placeholder="ì´ê³³ì— ê¸€ ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”"
											/>
										</div>
									</div>
									<div class="field">
										<label for="image" class="label">ì‚¬ì§„ ì²¨ë¶€</label>
										<div class="text -file">
											<input
												type="file"
												id="image"
												value="ìµœëŒ€ 30mb ì²¨ë¶€ ê°€ëŠ¥í•´ìš”"
											/>
										</div>
									</div>
									<div class="field">
										<label for="text3" class="label">ë‚ ì§œ ì„ íƒ</label>
										<div class="text">
											<input type="date" id="text3" required="" placeholder="ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”">
										</div>
									</div>
									<div class="field">
										<label for="textarea" class="label">ê¸€ ë‚´ìš©</label>
										<div class="textarea">
											<textarea
												id="textarea"
												placeholder="ì´ê³³ì— ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”"
											></textarea>
										</div>
									</div>
								</form>

								<div class="upload-gallery">
									<div class="img-box">
										<button type="button" class="img-view" onclick="modalOpenId('imgView1')">
											<img src="/assets/imgs/temp/temp1.png" alt="" />
										</button>
										<button type="button" class="close" onclick="deleteData(this, '.img-box')">
											<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
										</button>
									</div>
									<div class="img-box">
										<button type="button" class="img-view" onclick="modalOpenId('imgView2')">
											<img src="/assets/imgs/temp/temp2.png" alt="" />
										</button>
										<button type="button" class="close" onclick="deleteData(this, '.img-box')">
											<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
										</button>
									</div>
									<div class="img-box">
										<button type="button" class="img-view" onclick="modalOpenId('imgView3')">
											<img src="/assets/imgs/temp/temp3.png" alt="" />
										</button>
										<button type="button" class="close" onclick="deleteData(this, '.img-box')">
											<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
										</button>
									</div>
									<div class="img-box">
										<button type="button" class="img-view" onclick="modalOpenId('imgView1')">
											<img src="/assets/imgs/temp/temp1.png" alt="" />
										</button>
										<button type="button" class="close" onclick="deleteData(this, '.img-box')">
											<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
										</button>
									</div>
									<div class="img-box">
										<button type="button" class="img-view" onclick="modalOpenId('imgView2')">
											<img src="/assets/imgs/temp/temp2.png" alt="" />
										</button>
										<button type="button" class="close" onclick="deleteData(this, '.img-box')">
											<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
										</button>
									</div>
									<div class="img-box">
										<button type="button" class="img-view" onclick="modalOpenId('imgView3')">
											<img src="/assets/imgs/temp/temp3.png" alt="" />
										</button>
										<button type="button" class="close" onclick="deleteData(this, '.img-box')">
											<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
										</button>
									</div>
								</div>
							</div>

							<div class="map-content-buttons">
								<button type="button" id="editBtn" class="button -primary -lg">ì„ì‹œì €ì¥</button><!-- ìˆ˜ì •ìœ¼ë¡œ ë“¤ì–´ì˜¬ ì‹œ ìˆ˜ì •ì´ ë˜ë©´ disabled -->
								<button type="button" id="completeBtn" class="button -primary -lg">ì‘ì„±ì™„ë£Œ</button>
								<a href="../MY/MY010.html" id="goListBtn" class="button -secondary -lg">ëª©ë¡ìœ¼ë¡œ</a>
							</div>
						</div>
					</section>
				</div>
			</main>

			<footer class="footer">
				<!-- footer.html ë¡œ í˜ì´ì§€ í†µí•© ê´€ë¦¬ -->
			</footer>
		</div>
	</div>

	<div id="login-modal" class="modal -login-modal"></div>

	<div id="imgView1" class="modal">
		<div class="container">
			<header class="header">
				<div class="inner">
					<button type="button" class="close" onclick="modalClose()">
						<span class="hide">ë‹«ê¸°</span>
					</button>
				</div>
			</header>

			<main class="contents">
				<div class="content">
					<div class="img-view-box">
						<img src="/assets/imgs/temp/temp1.png" alt="" />
					</div>
				</div>
			</main>
		</div>
	</div>

	<div id="imgView2" class="modal">
		<div class="container">
			<header class="header">
				<div class="inner">
					<button type="button" class="close" onclick="modalClose()">
						<span class="hide">ë‹«ê¸°</span>
					</button>
				</div>
			</header>

			<main class="contents">
				<div class="content">
					<div class="img-view-box">
						<img src="/assets/imgs/temp/bigbigbig.jpg" alt="" />
					</div>
				</div>
			</main>
		</div>
	</div>

	<div id="imgView3" class="modal">
		<div class="container">
			<header class="header">
				<div class="inner">
					<button type="button" class="close" onclick="modalClose()">
						<span class="hide">ë‹«ê¸°</span>
					</button>
				</div>
			</header>

			<main class="contents">
				<div class="content">
					<div class="img-view-box">
						<img src="/assets/imgs/temp/temp-event-page1.jpg" alt="" />
					</div>
				</div>
			</main>
		</div>
	</div>

	<script src="/assets/libs/jquery/jquery-3.6.0.min.js"></script>
	<script src="/assets/libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="/assets/libs/jquery-ui/jquery.ui.touch-punch.min.js"></script>
	<script src="/assets/libs/swiper/dist/js/swiper.min.js"></script>
	<script src="/assets/js/style.js"></script>
	<script src="/assets/js/dev.js"></script>
    <script src="/assets/js/API.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=706f2ef595d7fa1279baace1d65f8f18&libraries=services"></script>
	<script src="/assets/js/map.js"></script>
	<script>
		// ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜
		async function initializeMap() {
			try {
				console.log('ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
				
				// SDK ë¡œë“œ í™•ì¸
				if (typeof kakao === 'undefined' || typeof kakao.maps === 'undefined') {
					throw new Error('ì¹´ì¹´ì˜¤ë§µ SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
				}

				// mapSeting í•¨ìˆ˜ í™•ì¸
				if (typeof window.mapSeting !== 'function') {
					throw new Error('mapSeting í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
				}

				// ì§€ë„ ì»¨í…Œì´ë„ˆ í™•ì¸
				const mapContainer = document.getElementById('map');
				if (!mapContainer) {
					throw new Error('ì§€ë„ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
				}

				// ì§€ë„ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì„¤ì •
				mapContainer.style.cssText = `
					width: 100%;
					height: 500px;
					position: relative;
					overflow: hidden;
					display: block !important;
					visibility: visible !important;
				`;

				// ì•½ê°„ì˜ ì§€ì—°ì„ ì£¼ì–´ DOMì´ ì™„ì „íˆ ì¤€ë¹„ë˜ë„ë¡ í•¨
				await new Promise(resolve => setTimeout(resolve, 100));

				// mapSeting í•¨ìˆ˜ ì‹¤í–‰
				window.mapSeting();
				console.log('ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
			} catch (error) {
				console.error('ì§€ë„ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
			}
		}

		// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
		document.addEventListener('DOMContentLoaded', function() {
			console.log('DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ');
			initializeMap();
		});

		// í¼ ì œì¶œ ì´ë²¤íŠ¸ ì²˜ë¦¬
		document
			.getElementById("placeForm")
			.addEventListener("submit", async (e) => {
				e.preventDefault();
				const formData = new FormData(e.target);
				const res = await fetch(`http://localhost:8081/places`, {
					method: "POST",
					body: formData,
				});
				const result = await res.json();
				alert(result.message);
				window.location.href = "../MY/MY030.html"; // ê¸€ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
			});

		// ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
		const imageInput = document.querySelector('input[type="file"]');
		imageInput.addEventListener("change", (e) => {
			const file = e.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = function (e) {
					// ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°ë¥¼ upload-galleryì— ì¶”ê°€
					const imgBox = document.createElement("div");
					imgBox.className = "img-box";
					imgBox.innerHTML = `
						<button type="button" class="img-view">
							<img src="${e.target.result}" alt="" />
						</button>
						<button type="button" class="close" onclick="this.parentElement.remove()">
							<span class="hide">ì‚¬ì§„ ì‚­ì œ</span>
						</button>
					`;
					document.querySelector(".upload-gallery").appendChild(imgBox);
				};
				reader.readAsDataURL(file);
			}
		});

		// ì‘ì„± ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		document.getElementById("completeBtn").onclick = async function () {
			const name = document.getElementById("name").value;
			const description = document.getElementById("textarea").value;
			const imageInput = document.getElementById("image");
			let imageUrl = "";
			
			// 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ
			if (imageInput.files[0]) {
				const formData = new FormData();
				formData.append("image", imageInput.files[0]);
				const res = await fetch(`http://localhost:8081/uploads`, {
					method: "POST",
					body: formData,
				});
				const data = await res.json();
				imageUrl = data.imageUrl;
			}
			
			// 2. ê¸€ ì •ë³´ JSONìœ¼ë¡œ ì €ì¥
			await fetch(`http://localhost:8081/place`, {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ name, description, imageUrl }),
			});
			window.location.href = "MY030.html";
		};

		// ëª©ë¡ìœ¼ë¡œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		document.getElementById("goListBtn").onclick = function () {
			window.location.href = "MY020.html";
		};
	</script>
    

</body>
</html>