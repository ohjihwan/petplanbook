<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CM020</title>
    <link rel="stylesheet" href="/assets/css/swiper.css" />
    <link rel="stylesheet" href="/assets/css/common-ui.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
  </head>
  <body>
    <div class="page">
      <div class="container">
        <header class="header">
          <!-- header.html Î°ú ÌéòÏù¥ÏßÄ ÌÜµÌï© Í¥ÄÎ¶¨ -->
        </header>

        <main class="contents">
          <div class="content">
            <section class="main-banner">
              <figure class="img-box">
                <img src="/assets/imgs/img/img-CM010-1.jpg" alt="" />
              </figure>
              <div class="text-box">
                <h2 class="title">Ï∂îÏ≤ú Î£®Ìä∏</h2>
                <p class="txt">
                  Îã§Î•∏ Î∞òÎ†§Ïù∏Îì§Ïù¥ Îã§ÎÖÄÏò® Î£®Ìä∏Î•º Í∑∏ÎåÄÎ°ú Îî∞Îùº Ìï¥Î≥¥ÏÑ∏Ïöî!
                </p>
                <div class="guide-arrow" aria-label="ÌïòÎã®Ïóê Ïª®ÌÖêÏ∏†Í∞Ä ÏûàÏäµÎãàÎã§">
                  <i></i>
                  <i></i>
                </div>
              </div>
            </section>

            <section class="map-content-area">
              <div class="inner">
                <div class="title-box">
                  <h2 class="title">Î£®Ìä∏Íæ∏ÎØ∏Í∏∞</h2>
                  <!--	
								ÏàòÏ†ïÌïòÍ∏∞ Í∏∞Îä• Ïãú
								<h2 class="title">ÏàòÏ†ïÌïòÍ∏∞</h2>
							-->
                  <p class="txt">Ï°∞Í∏àÎßå Îçî Íæ∏Î©∞Î≥ºÍπåÏöî?</p>
                </div>

							<div class="function-box -gray-case">
								<div class="following-path">
									<div class="scrolling swiper-wrapper">
										<ul id="routeList" class="swiper-slide">

											<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    const res = await fetch("http://localhost:8081/api/saved-routes"); // ‚Üê Í≤ΩÎ°ú Ï£ºÏùò
    const result = await res.json();

    if (!result.success) {
      throw new Error("Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®");
    }

    const slideList = document.querySelector(".swiper-slide");
    slideList.innerHTML = ""; // Í∏∞Ï°¥ ÎçîÎØ∏ Ï†úÍ±∞

    result.data.forEach((route) => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${route.title}</strong>
        <dl>
          <dt>Ï£ºÏÜå</dt>
          <dd>${route.addr1}</dd>
          <dt>Ï†ÑÌôî</dt>
          <dd>${route.tel}</dd>
          <dt>Î∂ÑÎ•ò</dt>
          <dd>${route.category}</dd>
        </dl>
      `;
      slideList.appendChild(li);
    });
  } catch (err) {
    console.error("üö´ Ï∂îÏ≤ú Î£®Ìä∏ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:", err.message);
  }
});
</script>

										</ul>
									</div>
								</div>
								<!-- API Í∏∞Îä• -->
								<div id="map" class="map-box"></div>
								<!-- // -->
								<form
									id="placeForm"
									enctype="multipart/form-data"
									class="field-area"
								>
									<div class="field">
										<label for="name" class="label">Í∏Ä Ï†úÎ™©</label>
										<div class="text">
											<input
												type="text"
												id="name"
												placeholder="Ïù¥Í≥≥Ïóê Í∏Ä Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî"
											/>
										</div>
									</div>
									<div class="field">
										<label for="image" class="label">ÏÇ¨ÏßÑ Ï≤®Î∂Ä</label>
										<div class="text -file">
											<input
												type="file"
												id="image"
												value="ÏµúÎåÄ 30mb Ï≤®Î∂Ä Í∞ÄÎä•Ìï¥Ïöî"
											/>
										</div>
									</div>
									<div class="field">
										<label for="text3" class="label">ÎÇ†Ïßú ÏÑ†ÌÉù</label>
										<div class="text">
											<input type="date" id="text3" required="" placeholder="ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî">
										</div>
									</div>
									<div class="field">
										<label for="textarea" class="label">Í∏Ä ÎÇ¥Ïö©</label>
										<div class="textarea">
											<textarea
												id="textarea"
												placeholder="Ïù¥Í≥≥Ïóê Í∏Ä ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî"
											></textarea>
										</div>
									</div>
								</form>

                  <div class="upload-gallery">
                    <div class="img-box">
                      <button
                        type="button"
                        class="img-view"
                        onclick="modalOpenId('imgView1')"
                      >
                        <img src="/assets/imgs/temp/temp1.png" alt="" />
                      </button>
                      <button
                        type="button"
                        class="close"
                        onclick="deleteData(this, '.img-box')"
                      >
                        <span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
                      </button>
                    </div>
                    <div class="img-box">
                      <button
                        type="button"
                        class="img-view"
                        onclick="modalOpenId('imgView2')"
                      >
                        <img src="/assets/imgs/temp/temp2.png" alt="" />
                      </button>
                      <button
                        type="button"
                        class="close"
                        onclick="deleteData(this, '.img-box')"
                      >
                        <span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
                      </button>
                    </div>
                    <div class="img-box">
                      <button
                        type="button"
                        class="img-view"
                        onclick="modalOpenId('imgView3')"
                      >
                        <img src="/assets/imgs/temp/temp3.png" alt="" />
                      </button>
                      <button
                        type="button"
                        class="close"
                        onclick="deleteData(this, '.img-box')"
                      >
                        <span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
                      </button>
                    </div>
                    <div class="img-box">
                      <button
                        type="button"
                        class="img-view"
                        onclick="modalOpenId('imgView1')"
                      >
                        <img src="/assets/imgs/temp/temp1.png" alt="" />
                      </button>
                      <button
                        type="button"
                        class="close"
                        onclick="deleteData(this, '.img-box')"
                      >
                        <span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
                      </button>
                    </div>
                    <div class="img-box">
                      <button
                        type="button"
                        class="img-view"
                        onclick="modalOpenId('imgView2')"
                      >
                        <img src="/assets/imgs/temp/temp2.png" alt="" />
                      </button>
                      <button
                        type="button"
                        class="close"
                        onclick="deleteData(this, '.img-box')"
                      >
                        <span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
                      </button>
                    </div>
                    <div class="img-box">
                      <button
                        type="button"
                        class="img-view"
                        onclick="modalOpenId('imgView3')"
                      >
                        <img src="/assets/imgs/temp/temp3.png" alt="" />
                      </button>
                      <button
                        type="button"
                        class="close"
                        onclick="deleteData(this, '.img-box')"
                      >
                        <span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="map-content-buttons">
                  <button
                    type="button"
                    id="editBtn"
                    class="button -primary -lg"
                  >
                    ÏûÑÏãúÏ†ÄÏû•</button
                  ><!-- ÏàòÏ†ïÏúºÎ°ú Îì§Ïñ¥Ïò¨ Ïãú ÏàòÏ†ïÏù¥ ÎêòÎ©¥ disabled -->
                  <button
                    type="button"
                    id="completeBtn"
                    class="button -primary -lg"
                  >
                    ÏûëÏÑ±ÏôÑÎ£å
                  </button>
                  <a
                    href="../MY/MY010.html"
                    id="goListBtn"
                    class="button -secondary -lg"
                    >Î™©Î°ùÏúºÎ°ú</a
                  >
                </div>
              </div>
            </section>
          </div>
        </main>

        <footer class="footer">
          <!-- footer.html Î°ú ÌéòÏù¥ÏßÄ ÌÜµÌï© Í¥ÄÎ¶¨ -->
        </footer>
      </div>
    </div>

    <div id="login-modal" class="modal -login-modal"></div>

    <div id="imgView1" class="modal">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">Îã´Í∏∞</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="img-view-box">
              <img src="/assets/imgs/temp/temp1.png" alt="" />
            </div>
          </div>
        </main>
      </div>
    </div>

    <div id="imgView2" class="modal">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">Îã´Í∏∞</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="img-view-box">
              <img src="/assets/imgs/temp/bigbigbig.jpg" alt="" />
            </div>
          </div>
        </main>
      </div>
    </div>

    <div id="imgView3" class="modal">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">Îã´Í∏∞</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="img-view-box">
              <img src="/assets/imgs/temp/temp-event-page1.jpg" alt="" />
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="/assets/libs/jquery/jquery-3.6.0.min.js"></script>
    <script src="/assets/libs/jquery-ui/jquery-ui.min.js"></script>
    <script src="/assets/libs/jquery-ui/jquery.ui.touch-punch.min.js"></script>
    <script src="/assets/libs/swiper/dist/js/swiper.min.js"></script>
    <script src="/assets/js/style.js"></script>
    <script src="/assets/js/dev.js"></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=706f2ef595d7fa1279baace1d65f8f18&libraries=services"
    ></script>
    <script src="/assets/js/map.js"></script>
    <script>
      // Ìèº Ï†úÏ∂ú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
      document
        .getElementById("placeForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const res = await fetch(`http://${HOST}:${PORT}/places`, {
            method: "POST",
            body: formData,
          });
          const result = await res.json();
          alert(result.message);
          window.location.href = "../MY/MY030.html"; // Í∏Ä Î™©Î°ù ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        });

      // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ Í∏∞Îä•
      const imageInput = document.querySelector('input[type="file"]');
      imageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞Î•º upload-galleryÏóê Ï∂îÍ∞Ä
            const imgBox = document.createElement("div");
            imgBox.className = "img-box";
            imgBox.innerHTML = `
						<button type="button" class="img-view">
							<img src="${e.target.result}" alt="" />
						</button>
						<button type="button" class="close" onclick="this.parentElement.remove()">
							<span class="hide">ÏÇ¨ÏßÑ ÏÇ≠Ï†ú</span>
						</button>
					`;
            document.querySelector(".upload-gallery").appendChild(imgBox);
          };
          reader.readAsDataURL(file);
        }
      });

		</script>	

<script>
document.getElementById("completeBtn").onclick = async function () {
  const name = document.getElementById("name").value;
  const description = document.getElementById("textarea").value;
  const date = document.getElementById("text3").value;
  const imageInput = document.getElementById("image");

  // ÌïÑÏàò Ìï≠Î™© ÌôïÏù∏
  if (!name || !description || !date) {
    alert("Í∏Ä Ï†úÎ™©, ÎÇ¥Ïö©, ÎÇ†ÏßúÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
    return;
  }

  let imageUrl = "";

  // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
  if (imageInput.files[0]) {
    const formData = new FormData();
    formData.append("image", imageInput.files[0]);

    const uploadRes = await fetch("http://localhost:8081/uploads", {
      method: "POST",
      body: formData,
    });

    if (!uploadRes.ok) {
      alert("Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ïã§Ìå®");
      return;
    }

    const uploadData = await uploadRes.json();
    imageUrl = uploadData.imageUrl;
  }

  // Ï∂îÏ≤ú Î£®Ìä∏ Î¶¨Ïä§Ìä∏ Ï∂îÏ∂ú
  const routeItems = document.querySelectorAll("#routeList li");
  const savedRoutes = Array.from(routeItems).map((li) => {
    return {
      title: li.querySelector("strong")?.innerText || "",
      addr1: li.querySelector("dd:nth-of-type(1)")?.innerText || "",
      tel: li.querySelector("dd:nth-of-type(2)")?.innerText || "",
      category: li.querySelector("dd:nth-of-type(3)")?.innerText || "",
      firstimage: li.querySelector("img")?.src || "",
      date: date, // Ï∂îÏ≤ú Î£®Ìä∏ÏóêÎèÑ ÎÇ†Ïßú Ìè¨Ìï®
    };
  });

  // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
  const payload = {
    name,
    description,
    date,
    imageUrl,
    savedRoutes,
  };

  const res = await fetch("http://localhost:8081/api/save-route-post", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload),
  });

  if (res.ok) {
    alert("Ï†ÄÏû• ÏôÑÎ£å!");
    window.location.href = "MY030.html";
  } else {
    alert("Ï†ÄÏû• Ïã§Ìå®");
  }
};
</script>



</body>
</html>
